import e from"@babel/runtime/helpers/defineProperty";import t from"@babel/runtime/helpers/asyncToGenerator";import r from"@babel/runtime/regenerator";import{ChainId as o,Token as i,CurrencyAmount as n}from"@uniswap/sdk-core";import{StaticV2SubgraphProvider as a,UniswapMulticallProvider as s,OnChainQuoteProvider as u,AlphaRouter as p,routeAmountsToString as m}from"@uniswap/smart-order-router";import{Q as c,i as l,S as d,n as b}from"./index-6e70994f.js";import h from"jsbi";import{Protocol as f}from"@uniswap/router-sdk";import"react";import"@babel/runtime/helpers/slicedToArray";import"styled-components";import"buffer";import"@web3-react/core";import"@babel/runtime/helpers/extends";import"@babel/runtime/helpers/objectWithoutProperties";import"polished";import"@babel/runtime/helpers/taggedTemplateLiteral";import"wcag-contrast";import"rebass";import"react-feather";import"@babel/runtime/helpers/toConsumableArray";import"@uniswap/analytics-events";import"@uniswap/analytics";import"jotai/utils";import"@ethersproject/bignumber";import"@uniswap/v3-sdk";import"rebass/styled-components";import"@babel/runtime/helpers/classCallCheck";import"@babel/runtime/helpers/createClass";import"@ethersproject/abi";import"@uniswap/redux-multicall";import"@babel/runtime/helpers/inherits";import"@babel/runtime/helpers/possibleConstructorReturn";import"@babel/runtime/helpers/getPrototypeOf";import"tiny-invariant";import"@ethersproject/address";import"@ethersproject/constants";import"@ethersproject/contracts";import"popper-max-size-modifier";import"react-dom";import"react-popper";import"@reduxjs/toolkit";import"wicg-inert";import"@babel/runtime/helpers/get";import"setimmediate";import"@web3-react/walletconnect-v2";import"qrcode";import"jotai";import"@babel/runtime/helpers/objectDestructuringEmpty";import"jotai/immer";import"@babel/runtime/helpers/assertThisInitialized";import"@babel/runtime/helpers/wrapNativeSuper";import"@ethersproject/bytes";import"@ethersproject/strings";import"@ethersproject/hash";import"cids";import"multicodec";import"multihashes";import"@uniswap/conedison/format";import"@uniswap/v2-sdk";import"ethers/lib/utils";import"@reduxjs/toolkit/query/react";import"@ethersproject/units";import"@babel/runtime/helpers/typeof";import"qs";import"react-redux";import"@uniswap/universal-router-sdk";import"@uniswap/permit2-sdk";import"@uniswap/conedison/provider/signing";import"node-vibrant/lib/bundle.js";import"react-virtualized-auto-sizer";import"react-window";import"@uniswap/conedison/provider/index";import"@ethersproject/providers";import"@web3-react/eip1193";import"@web3-react/metamask";import"@web3-react/network";import"@web3-react/types";import"make-plural/plurals";import"redux";import"resize-observer-polyfill";function y(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return v(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,n=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw n}}}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function g(e){var t,r=e.quote,o=e.quoteGasAdjusted,i=e.route,n=e.routeString,a=e.estimatedGasUsed,s=e.estimatedGasUsedQuoteToken,u=e.estimatedGasUsedUSD,p=e.gasPriceWei,m=e.methodParameters,d=e.blockNumber,b=e.trade,h=b.tradeType,v=b.inputAmount,g=b.outputAmount,w=[],k=y(i);try{for(k.s();!(t=k.n()).done;){var I=t.value,S=I.amount,O=I.quote,j=I.tokenPath;if(I.protocol===f.V3){for(var q=I.route.pools,x=[],P=0;P<q.length;P++){var A=q[P],C=j[P],E=j[P+1],D=void 0;0===P&&(D=l(h)?S.quotient.toString():O.quotient.toString());var T=void 0;P===q.length-1&&(T=l(h)?O.quotient.toString():S.quotient.toString()),x.push({type:"v3-pool",tokenIn:{chainId:C.chainId,decimals:C.decimals,address:C.address,symbol:C.symbol},tokenOut:{chainId:E.chainId,decimals:E.decimals,address:E.address,symbol:E.symbol},fee:A.fee.toString(),liquidity:A.liquidity.toString(),sqrtRatioX96:A.sqrtRatioX96.toString(),tickCurrent:A.tickCurrent.toString(),amountIn:D,amountOut:T})}w.push(x)}else if(I.protocol===f.V2){for(var U=I.route.pairs,N=[],G=0;G<U.length;G++){var L=U[G],M=j[G],R=j[G+1],z=void 0;0===G&&(z=l(h)?S.quotient.toString():O.quotient.toString());var Q=void 0;G===U.length-1&&(Q=l(h)?O.quotient.toString():S.quotient.toString());var W=L.reserve0,B=L.reserve1;N.push({type:"v2-pool",tokenIn:{chainId:M.chainId,decimals:M.decimals,address:M.address,symbol:M.symbol},tokenOut:{chainId:R.chainId,decimals:R.decimals,address:R.address,symbol:R.symbol},reserve0:{token:{chainId:W.currency.wrapped.chainId,decimals:W.currency.wrapped.decimals,address:W.currency.wrapped.address,symbol:W.currency.wrapped.symbol},quotient:W.quotient.toString()},reserve1:{token:{chainId:B.currency.wrapped.chainId,decimals:B.currency.wrapped.decimals,address:B.currency.wrapped.address,symbol:B.currency.wrapped.symbol},quotient:B.quotient.toString()},amountIn:z,amountOut:Q})}w.push(N)}}}catch(e){k.e(e)}finally{k.f()}var V=l(h)?v:g;return{state:c.SUCCESS,data:{methodParameters:m,blockNumber:d.toString(),amount:V.quotient.toString(),amountDecimals:V.toExact(),quote:r.quotient.toString(),quoteDecimals:r.toExact(),quoteGasAdjusted:o.quotient.toString(),quoteGasAdjustedDecimals:o.toExact(),gasUseEstimateQuote:s.quotient.toString(),gasUseEstimateQuoteDecimals:s.toExact(),gasUseEstimate:a.toString(),gasUseEstimateUSD:u.toExact(),gasPriceWei:p.toString(),route:w,routeString:n}}}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function k(t){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?w(Object(o),!0).forEach((function(r){e(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):w(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var I=Object.values(o).filter((function(e){return Number.isInteger(e)}));var S=new WeakMap;function O(e,t){var r,i,n,m=S.get(t)||{},c=m[e];if(c)return c;e!==o.MAINNET&&(r=new a(e)),[o.POLYGON,o.POLYGON_MUMBAI].includes(e)&&(n=new s(e,t,375e3),i=new u(e,t,n,{retries:2,minTimeout:100,maxTimeout:1e3},{multicallChunk:10,gasLimitPerCall:5e6,quoteMinSuccessRate:.1},{gasLimitOverride:5e6,multicallChunk:5},{gasLimitOverride:625e4,multicallChunk:4}));var l=new p({chainId:e,provider:t,v2SubgraphProvider:r,multicall2Provider:n,onChainQuoteProvider:i});return m[e]=l,S.set(t,m),l}function j(e,t,r){return q.apply(this,arguments)}function q(){return(q=t(r.mark((function e(t,o,a){var s,u,p,f,y,v,w,I,S,O,j,q;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.tradeType,u=t.tokenIn,p=t.tokenOut,f=t.amount,y=Object.values(d).includes(u.address),v=Object.values(d).includes(p.address),w=y?b(u.chainId):new i(u.chainId,u.address,u.decimals,u.symbol),I=v?b(p.chainId):new i(p.chainId,p.address,p.decimals,p.symbol),S=l(s)?w:I,O=l(s)?I:w,j=n.fromRawAmount(S,h.BigInt(null!=f?f:"1")),e.next=10,o.route(j,O,s,void 0,a);case 10:if(q=e.sent,f){e.next=13;break}return e.abrupt("return",{state:c.INITIALIZED});case 13:if(q){e.next=15;break}return e.abrupt("return",{state:c.NOT_FOUND});case 15:return e.abrupt("return",g(k(k({},q),{},{routeString:m(q.route)})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e,t){return P.apply(this,arguments)}function P(){return(P=t(r.mark((function e(t,o){var i,n,a,s,u,p,m,c,l,d,b,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.tokenInAddress,n=t.tokenInChainId,a=t.tokenInDecimals,s=t.tokenInSymbol,u=t.tokenOutAddress,p=t.tokenOutChainId,m=t.tokenOutDecimals,c=t.tokenOutSymbol,l=t.amount,d=t.tradeType,b=t.provider,r=n,Boolean(r&&I.includes(r))){e.next=3;break}throw new Error("Router does not support this token's chain (chainId: ".concat(n,")."));case 3:return h=O(n,b),e.abrupt("return",j({tradeType:d,tokenIn:{address:i,chainId:n,decimals:a,symbol:s},tokenOut:{address:u,chainId:p,decimals:m,symbol:c},amount:l},h,o));case 5:case"end":return e.stop()}var r}),e)})))).apply(this,arguments)}export{x as getClientSideQuoteResult};
